{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}

<div class="container-fluid">

    <a href="{% url 'booking:create' %}" class="btn btn-primary title-action">Ajouter</a>
    <h1>Réservations</h1>

    {% crispy filter.form %}

    <table class="table table-striped table-hover">
        <tr>
            <th>Centre</th>
            <th>Intitulé</th>
            <th>Statut</th>
            <th>Du <span class="glyphicon glyphicon-chevron-down"></span></th>
            <th>Au</th>
            <th>Nuits</th>
            <th>Effectif</th>
            <th>Nuitées</th>
            <th>Montant</th>
            <th>Solde</th>
            <th>Convention</th>
        </tr>
        {% for booking in booking_list %}
            <tr {% ifchanged booking.gone %}class="separator"{% endifchanged %}>
                <td>{{ booking.structure }}</td>
                <td><a href="{{ booking.get_absolute_url }}">{{ booking.title }}</a></td>
                <td><span class="label label-{{ booking.state.color }}">{{ booking.state.title }}</span></td>
                <td align="right">{{ booking.begin|date:'D d/m/y' }}</td>
                <td align="right">{{ booking.end|date:'D d/m/y' }}</td>
                <td align="right">{{ booking.nights|default_if_none:"" }}</td>
                <td align="right">{{ booking.headcount|default_if_none:"" }}</td>
                <td align="right">{{ booking.overnights|default_if_none:"" }}</td>
                <td align="right">{% if booking.amount %}{{ booking.amount|floatformat:2 }} €{% endif %}</td>
                <td align="right">{% if booking.balance %}{{ booking.balance|floatformat:2 }} €{%  endif %}</td>
                <td>
                    {%  if booking.agreement and booking.agreement.pdf %}
                        <a href="{{ booking.agreement.pdf.url }}">{{ booking.agreement.number }}</a>
                    {% else %}{% comment %}
                        <a href="{% url 'booking:create_agreement' booking.id %}" class="btn btn-xs btn-primary">
                            <span class="glyphicon glyphicon-file"></span>
                            Créer
                        </a>{%endcomment %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        <tr class="total">
            <td>Total</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td align="right">{{ headcount }}</td>
            <td align="right">{{ overnights }}</td>
            <td align="right">{{ amount }} €</td>
            <td align="right">{{ balance }} €</td>
            <td></td>
        </tr>
    </table>

</div>

{% endblock content %}


{% block js %}

    {{ block.super }}

    <script>
        $('select, :checkbox').change(function() {$('form').submit()});
    </script>

{% endblock js %}
